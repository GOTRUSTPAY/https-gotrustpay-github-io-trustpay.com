!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GoTrust Pay</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<!-- QR -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<style>
:root{
  --bg:#021c1b;
  --panel:#043837;
  --card:#065f5b;
  --accent:#14b8a6;
  --text:#d1fae5;
}
*{box-sizing:border-box}
body{
  margin:0;font-family:Arial,Helvetica,sans-serif;
  background:linear-gradient(135deg,#021c1b,#032f2e);
  color:var(--text);
}
header{
  background:#021c1b;
  padding:15px 25px;
  display:flex;
  align-items:center;
  justify-content:space-between;
}
.logo{
  display:flex;align-items:center;gap:12px;
}
.logo svg{width:48px;height:48px}
nav a{
  color:#99f6e4;
  margin-left:20px;
  cursor:pointer;
  font-weight:bold;
  text-decoration:none;
}
main{max-width:1200px;margin:25px auto;padding:20px}
.hidden{display:none}

button{
  background:var(--accent);
  border:none;
  padding:10px 16px;
  border-radius:8px;
  font-weight:bold;
  cursor:pointer;
}
button:hover{opacity:.9}

input,select,textarea{
  width:100%;
  padding:10px;
  margin:6px 0;
  border-radius:6px;
  border:none;
}

/* CARD */
.card{
  background:linear-gradient(135deg,#054a48,#022c2a);
  border-radius:18px;
  padding:25px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  box-shadow:0 10px 30px rgba(0,0,0,.6);
}
.chip{
  width:50px;height:38px;
  background:linear-gradient(135deg,#facc15,#eab308);
  border-radius:6px;
  margin-bottom:10px;
}

/* SECTIONS */
.panel{
  background:var(--panel);
  border-radius:14px;
  padding:20px;
  margin-top:20px;
}

.activity{
  background:#022c2a;
  padding:10px;
  border-radius:10px;
  margin-bottom:8px;
  display:flex;
  justify-content:space-between;
  font-size:14px;
}
</style>
</head>

<body>

<header>
  <div class="logo">
    <!-- LOGO SVG TELECHARGEABLE -->
    <svg id="gtpLogo" viewBox="0 0 100 100">
      <defs>
        <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
          <stop offset="0%" stop-color="#14b8a6"/>
          <stop offset="100%" stop-color="#065f5b"/>
        </linearGradient>
      </defs>
      <shield fill="url(#g)"/>
      <path d="M50 5 L90 25 V55 C90 75 70 90 50 95 C30 90 10 75 10 55 V25 Z" fill="url(#g)"/>
      <path d="M35 52 L47 64 L67 40" fill="none" stroke="#ecfeff" stroke-width="8"/>
    </svg>
    <div>
      <b>GoTrust Pay</b><br>
      <small>Paiements sécurisés</small>
    </div>
  </div>
  <nav>
    <a onclick="show('home')">Accueil</a>
    <a onclick="show('login')">Connexion</a>
  </nav>
</header>

<main>

<!-- HOME -->
<div id="home">
  <div class="panel">
    <h2>Publications officielles</h2>
    <div id="publications"></div>
  </div>

  <div class="panel">
    <h2>Activités récentes</h2>
    <div id="activities"></div>
  </div>
</div>

<!-- LOGIN -->
<div id="login" class="hidden panel">
  <h2>Connexion</h2>
  <input id="email" placeholder="Email">
  <input id="password" type="password" placeholder="Mot de passe">
  <button onclick="login()">Se connecter</button>

  <h3>Créer un compte</h3>
  <input id="name" placeholder="Nom complet">
  <input id="phone" placeholder="Téléphone">
  <input id="regEmail" placeholder="Email">
  <input id="regPass" type="password" placeholder="Mot de passe">
  <button onclick="register()">Créer le compte</button>
</div>

<!-- DASHBOARD -->
<div id="dashboard" class="hidden">

  <div class="card">
    <div>
      <div class="chip"></div>
      <h3 id="cardName"></h3>
      <p>ID : <span id="cardId"></span></p>
      <p>Numéro : <span id="cardNumber"></span></p>
      <p><b>Solde : <span id="balance"></span> USD</b></p>
    </div>
    <div>
      <div id="clientQR" style="background:#fff;padding:6px;border-radius:8px"></div>
      <button onclick="downloadQR()">Télécharger QR</button>
      <button onclick="downloadLogo()">Télécharger logo</button>
    </div>
  </div>

  <!-- ACTIONS -->
  <div class="panel">
    <h3>Dépôt</h3>
    <input id="depAmount" type="number" placeholder="Montant">
    <button onclick="deposit()">Confirmer dépôt</button>

    <h3>Retrait</h3>
    <input id="witAmount" type="number" placeholder="Montant">
    <button onclick="withdraw()">Confirmer retrait</button>

    <h3>Envoyer argent</h3>
    <input id="sendAmount" type="number" placeholder="Montant">
    <input id="sendEmail" placeholder="Email destinataire">
    <button onclick="sendMoney()">Envoyer</button>

    <h3>Demande de prêt</h3>
    <input id="loanAmount" type="number" placeholder="Montant">
    <textarea id="loanReason" placeholder="Motif"></textarea>
    <button onclick="loan()">Envoyer demande</button>
  </div>

</div>

</main>

<script>
// FIREBASE
firebase.initializeApp({
 apiKey:"AIzaSyA-p_WgDeRhaGsP0zJYmd9aIw7GwuC6k6g",
 authDomain:"gotrustpay-e6524.firebaseapp.com",
 projectId:"gotrustpay-e6524"
});
const auth=firebase.auth(), db=firebase.firestore();

// NAV
function show(id){
 document.querySelectorAll("main>div").forEach(d=>d.classList.add("hidden"));
 document.getElementById(id).classList.remove("hidden");
}

// REGISTER
function randomCard(){return "4896 "+Math.floor(1000+Math.random()*9000)+" **** ****"}
function register(){
 auth.createUserWithEmailAndPassword(regEmail.value,regPass.value)
 .then(c=>db.collection("users").doc(c.user.uid).set({
  name:name.value, phone:phone.value,
  card:randomCard(), balance:0, role:"client"
 }));
}

// LOGIN
function login(){
 auth.signInWithEmailAndPassword(email.value,password.value);
}

// AUTH
auth.onAuthStateChanged(u=>{
 if(!u){show("home");return;}
 db.collection("users").doc(u.uid).get().then(d=>{
  const x=d.data();
  show("dashboard");
  cardName.textContent=x.name;
  cardId.textContent=u.uid.slice(0,10).toUpperCase();
  cardNumber.textContent=x.card;
  balance.textContent=x.balance.toFixed(2);
  clientQR.innerHTML="";
  new QRCode("clientQR",{text:u.uid,width:130,height:130});
 });
 loadActivities(); loadPublications();
});

// TRANSACTIONS
function deposit(){updateBalance(+depAmount.value)}
function withdraw(){updateBalance(-witAmount.value)}
function updateBalance(v){
 const ref=db.collection("users").doc(auth.currentUser.uid);
 ref.update({balance:firebase.firestore.FieldValue.increment(Number(v))})
 .then(()=>ref.get().then(d=>balance.textContent=d.data().balance.toFixed(2)));
}
function sendMoney(){
 db.collection("users").where("email","==",sendEmail.value).get().then(s=>{
  if(s.empty)return alert("Destinataire introuvable");
  updateBalance(-sendAmount.value);
  db.collection("users").doc(s.docs[0].id)
  .update({balance:firebase.firestore.FieldValue.increment(Number(sendAmount.value))});
 });
}
function loan(){
 db.collection("loans").add({
  user:auth.currentUser.uid,
  amount:loanAmount.value,
  reason:loanReason.value,
  date:new Date()
 });
 alert("Demande envoyée");
}

// ACTIVITIES
const names=["Amina R.","Jean K.","Patrick M.","Sofia L.","Daniel K."];
function loadActivities(){
 activities.innerHTML="";
 names.forEach((n,i)=>{
  activities.innerHTML+=`<div class="activity">${n} a effectué une transaction<span>${i+1} j</span></div>`;
 });
}

// PUBLICATIONS
function loadPublications(){
 publications.innerHTML="";
 db.collection("publications").orderBy("date","desc").get()
 .then(s=>s.forEach(d=>publications.innerHTML+=`<div class="activity">${d.data().text}</div>`));
}

// DOWNLOAD LOGO
function downloadLogo(){
 const svg=document.getElementById("gtpLogo").outerHTML;
 const blob=new Blob([svg],{type:"image/svg+xml"});
 const a=document.createElement("a");
 a.href=URL.createObjectURL(blob);
 a.download="gotrustpay-logo.svg";
 a.click();
}
</script>

</body>
</html>
