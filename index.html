<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GoTrust Pay</title>
<style>
body { margin:0; font-family: Arial, sans-serif; background:#f5f5f5; color:#333; }
header { background:#0a74da; color:#fff; padding:20px; text-align:center; }
nav { display:flex; justify-content:center; gap:15px; padding:10px; background:#0073c2; flex-wrap:wrap;}
nav a { color:#fff; text-decoration:none; font-weight:bold; }
main { max-width:1000px; margin:20px auto; padding:20px; background:#fff; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
h2 { color:#0a74da; margin-top:0; }
button { background:#0a74da; color:#fff; border:none; padding:10px 20px; border-radius:5px; cursor:pointer; margin-top:5px; }
input, select, textarea { padding:10px; margin:5px 0; width:100%; box-sizing:border-box; }
.section { margin-bottom:40px; }
.hidden { display:none; }
.card { border:1px solid #ddd; padding:15px; border-radius:8px; margin-bottom:15px; background:#f9f9f9; }
.qr { width:120px; height:120px; display:inline-block; margin-right:10px; vertical-align:middle; }
label { font-weight:bold; display:block; margin-top:10px; }
.menu { display:flex; gap:10px; margin-bottom:20px; flex-wrap:wrap; }
.client-card { display:flex; align-items:center; justify-content:space-between; border:2px solid #0a74da; padding:20px; border-radius:15px; background:linear-gradient(135deg,#0a74da,#00bfff); color:#fff; box-shadow:0 5px 15px rgba(0,0,0,0.3); }
.client-info p { margin:5px 0; font-weight:bold; }
</style>
</head>
<body>

<header>
  <h1>GoTrust Pay</h1>
  <p>Plateforme financière sécurisée</p>
</header>

<nav>
  <a href="#" onclick="showSection('home')">Accueil</a>
  <a href="#" onclick="showSection('login')">Connexion</a>
  <a href="#" onclick="showSection('contact')">Contact</a>
  <a href="#" onclick="showSection('about')">Qui sommes-nous ?</a>
  <a href="#" onclick="showSection('services')">Services</a>
  <a href="#" onclick="showSection('partners')">Partenaires</a>
</nav>

<main>
  <div class="section" id="home">
    <h2>Bienvenue sur GoTrust Pay</h2>
    <p>Plateforme sécurisée pour gérer vos paiements, dépôts, retraits et prêts.</p>
    <div id="homeMessages"></div>
  </div>

  <div class="section hidden" id="login">
    <h2>Connexion</h2>
    <label>Statut</label>
    <select id="loginStatus">
      <option value="client">Client</option>
      <option value="admin">Admin</option>
    </select>
    <input type="text" id="loginId" placeholder="ID ou Email">
    <input type="password" id="loginPassword" placeholder="Mot de passe">
    <button onclick="login()">Se connecter</button>

    <div style="margin-top:20px; border-top:1px solid #ddd; padding-top:15px;">
      <h3>Créer un compte client</h3>
      <label>Nom complet</label><input type="text" id="regName">
      <label>Email</label><input type="email" id="regEmail">
      <label>Téléphone</label><input type="text" id="regPhone">
      <label>Mot de passe (8 chiffres)</label><input type="password" id="regPassword">
      <label>Code de retrait (6 chiffres)</label><input type="text" id="regCode">
      <button onclick="register()">S'inscrire et accéder au tableau de bord</button>
    </div>
  </div>

  <div class="section hidden" id="clientDashboard">
    <h2>Tableau de bord Client</h2>
    <div class="client-card" id="clientCard">
      <div class="client-info">
        <p>ID : <span id="clientIdDisplay"></span></p>
        <p>Numéro de carte : <span id="clientCardNumber"></span></p>
        <p>Solde : <span id="clientBalance">0.00 USD</span></p>
        <button onclick="downloadCard()">Télécharger Carte</button>
      </div>
      <div id="clientQR" class="qr"></div>
    </div>

    <div class="menu">
      <button onclick="showClientSection('deposit')">Déposer</button>
      <button onclick="showClientSection('withdraw')">Retirer</button>
      <button onclick="showClientSection('send')">Envoyer argent</button>
    </div>

    <div id="clientActions">
      <div class="hidden" id="deposit">
        <h3>Déposer de l'argent</h3>
        <input type="number" id="depositAmount" placeholder="Montant">
        <select id="depositService">
          <option value="gopay">GoPay</option>
          <option value="airtel">Airtel Money</option>
        </select>
        <button onclick="deposit()">Confirmer Dépôt</button>
      </div>

      <div class="hidden" id="withdraw">
        <h3>Retirer de l'argent</h3>
        <input type="number" id="withdrawAmount" placeholder="Montant">
        <input type="text" id="withdrawCode" placeholder="Code de retrait">
        <button onclick="withdraw()">Confirmer Retrait</button>
      </div>

      <div class="hidden" id="send">
        <h3>Envoyer de l'argent</h3>
        <input type="number" id="sendAmount" placeholder="Montant">
        <input type="text" id="sendRecipient" placeholder="ID destinataire">
        <input type="password" id="sendPassword" placeholder="Mot de passe">
        <button onclick="sendMoney()">Envoyer</button>
      </div>
    </div>

    <h3>Activités récentes</h3>
    <div id="recentActivities"></div>
  </div>

  <div class="section hidden" id="adminDashboard">
    <h2>Tableau de bord Admin</h2>
    <div class="menu">
      <button onclick="showAdminSection('publish')">Publier message</button>
      <button onclick="showAdminSection('clients')">Clients</button>
      <button onclick="showAdminSection('history')">Historique</button>
    </div>

    <div id="adminActions">
      <div class="hidden" id="publish">
        <h3>Publier un message</h3>
        <textarea id="adminMessage"></textarea>
        <button onclick="publishMessage()">Publier</button>
      </div>

      <div class="hidden" id="clients">
        <h3>Clients</h3>
        <div id="clientsList"></div>
      </div>

      <div class="hidden" id="history">
        <h3>Historique</h3>
        <div id="historyList"></div>
      </div>
    </div>
  </div>

</main>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA-p_WgDeRhaGsP0zJYmd9aIw7GwuC6k6g",
  authDomain: "gotrustpay-e6524.firebaseapp.com",
  projectId: "gotrustpay-e6524",
  storageBucket: "gotrustpay-e6524.appspot.com",
  messagingSenderId: "177034024636",
  appId: "1:177034024636:web:da80102cc82dd7cfa2a2b9"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let currentUser=null;
let users=[], history=[], activities=[];

function showSection(id){document.querySelectorAll('main .section').forEach(s=>s.classList.add('hidden'));document.getElementById(id).classList.remove('hidden');}
function showClientSection(id){document.querySelectorAll('#clientActions > div').forEach(d=>d.classList.add('hidden'));document.getElementById(id).classList.remove('hidden');}
function showAdminSection(id){document.querySelectorAll('#adminActions > div').forEach(d=>d.classList.add('hidden'));document.getElementById(id).classList.remove('hidden');}

function generateId(){return Math.floor(10000000+Math.random()*90000000);}
function generateCard(){return Math.floor(100000000000+Math.random()*900000000000);}

function updateClientCard(user){
  document.getElementById('clientIdDisplay').textContent=user.id;
  document.getElementById('clientCardNumber').textContent=user.cardNumber;
  document.getElementById('clientBalance').textContent=user.balance.toFixed(2)+' USD';
  document.getElementById('clientQR').innerHTML='';
  new QRCode(document.getElementById('clientQR'), user.id);
}

function downloadCard(){
  html2canvas(document.getElementById('clientCard')).then(canvas=>{
    let link=document.createElement('a');
    link.download='carte_'+currentUser.id+'.png';
    link.href=canvas.toDataURL();
    link.click();
  });
}

function register(){
  let name=document.getElementById('regName').value;
  let email=document.getElementById('regEmail').value;
  let phone=document.getElementById('regPhone').value;
  let password=document.getElementById('regPassword').value;
  let code=document.getElementById('regCode').value;
  if(!name||!email||!phone||!password||!code){alert('Remplir tous les champs'); return;}
  let user={id:generateId(),name,email,phone,password,code,balance:0,cardNumber:generateCard(),status:'client'};
  users.push(user);
  currentUser=user;
  updateClientCard(currentUser);
  showSection('clientDashboard');
  activities.unshift({text:`Compte créé pour ${user.name}`,date:new Date()});
  updateRecentActivities();
  alert('Compte créé ! ID : '+user.id);
}

function login(){
  let status=document.getElementById('loginStatus').value;
  let id=document.getElementById('loginId').value.trim();
  let pwd=document.getElementById('loginPassword').value;
  if(status==='admin' && id==='gopay' && pwd==='admin243'){currentUser={name:'Admin',id:'gopay',status:'admin'}; showSection('adminDashboard'); renderAdminClients(); renderAdminHistory(); return;}
  let user=users.find(u=>u.id==id && u.password===pwd);
  if(!user){alert('Utilisateur introuvable'); return;}
  currentUser=user;
  showSection('clientDashboard');
  updateClientCard(currentUser);
}

function deposit(){
  let amt=parseFloat(document.getElementById('depositAmount').value);
  if(isNaN(amt)||amt<=0){alert('Montant invalide'); return;}
  currentUser.balance+=amt;
  updateClientCard(currentUser);
  history.unshift({type:'Dépôt',user:currentUser.name,amount:amt,date:new Date()});
  activities.unshift({text:`${currentUser.name} a déposé ${amt} USD`,date:new Date()});
  updateRecentActivities();
  alert('Dépôt effectué');
}

function withdraw(){
  let amt=parseFloat(document.getElementById('withdrawAmount').value);
  let code=document.getElementById('withdrawCode').value;
  if(isNaN(amt)||amt<=0){alert('Montant invalide'); return;}
  if(code!==currentUser.code){alert('Code incorrect'); return;}
  if(currentUser.balance<amt){alert('Solde insuffisant'); return;}
  currentUser.balance-=amt;
  updateClientCard(currentUser);
  history.unshift({type:'Retrait',user:currentUser.name,amount:amt,date:new Date()});
  activities.unshift({text:`${currentUser.name} a retiré ${amt} USD`,date:new Date()});
  updateRecentActivities();
  alert('Retrait effectué');
}

function sendMoney(){
  let amt=parseFloat(document.getElementById('sendAmount').value);
  let recId=document.getElementById('sendRecipient').value;
  let pwd=document.getElementById('sendPassword').value;
  if(pwd!==currentUser.password){alert('Mot de passe incorrect'); return;}
  let rec=users.find(u=>u.id==recId);
  if(!rec){alert('Destinataire introuvable'); return;}
  if(currentUser.balance<amt){alert('Solde insuffisant'); return;}
  currentUser.balance-=amt;
  rec.balance+=amt;
  updateClientCard(currentUser);
  history.unshift({type:'Envoi',user:currentUser.name,to:rec.name,amount:amt,date:new Date()});
  activities.unshift({text:`${currentUser.name} a envoyé ${amt} USD à ${rec.name}`,date:new Date()});
  updateRecentActivities();
  alert('Envoi effectué');
}

// ================== Admin ==================
function renderAdminClients(){
  let list=document.getElementById('clientsList'); list.innerHTML='';
  users.forEach(u=>list.innerHTML+=`<div class="card">${u.name} - ID: ${u.id} - Solde: ${u.balance.toFixed(2)} USD</div>`);
}
function renderAdminHistory(){
  let list=document.getElementById('historyList'); list.innerHTML='';
  history.forEach(h=>list.innerHTML+=`<div class="card">${h.type} - ${h.user} - ${h.amount?h.amount+' USD':''} - ${h.date.toLocaleString()}</div>`);
}
function publishMessage(){
  let msg=document.getElementById('adminMessage').value;
  if(!msg){alert('Message vide'); return;}
  let home=document.getElementById('homeMessages');
  let div=document.createElement('div'); div.className='card'; div.textContent=msg;
  home.prepend(div);
  alert('Message publié sur l’accueil');
}

// ================== Activités ==================
function updateRecentActivities(){
  let container=document.getElementById('recentActivities'); container.innerHTML='';
  activities.slice(0,10).forEach(a=>container.innerHTML+=`<div class="card">${a.text} - ${a.date.toLocaleTimeString()}</div>`);
}
setInterval(()=>{
  if(users.length===0) return;
  let randomUser=users[Math.floor(Math.random()*users.length)];
  let randomAmt=(Math.floor(Math.random()*100)+1);
  let txt=`${randomUser.name} a effectué une activité aléatoire de ${randomAmt} USD`;
  activities.unshift({text:txt,date:new Date()});
  updateRecentActivities();
},5000);

</script>
</body>
</html>
