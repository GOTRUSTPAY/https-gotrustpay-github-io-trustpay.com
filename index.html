<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GoTrust Pay</title>
<style>
body { margin:0; font-family: Arial, sans-serif; background:#f5f5f5; color:#333; }
header { background:#0a74da; color:#fff; padding:20px; text-align:center; }
nav { display:flex; justify-content:center; gap:15px; padding:10px; background:#0073c2; flex-wrap:wrap;}
nav a { color:#fff; text-decoration:none; font-weight:bold; cursor:pointer;}
main { max-width:1000px; margin:20px auto; padding:20px; background:#fff; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
h2 { color:#0a74da; margin-top:0; }
button { background:#0a74da; color:#fff; border:none; padding:10px 20px; border-radius:5px; cursor:pointer; margin-top:5px; }
input, select, textarea { padding:10px; margin:5px 0; width:100%; box-sizing:border-box; }
.section { margin-bottom:40px; }
.hidden { display:none; }
.card { border:1px solid #ddd; padding:15px; border-radius:8px; margin-bottom:15px; background:#f9f9f9; }
.qr { width:100px; height:100px; display:inline-block; margin-right:10px; vertical-align:middle; }
label { font-weight:bold; display:block; margin-top:10px; }
.menu { display:flex; gap:10px; margin-bottom:20px; flex-wrap:wrap; }
.message { border:1px solid #ddd; padding:10px; border-radius:5px; margin-bottom:5px; background:#eef; }
</style>
</head>
<body>

<header>
  <h1>GoTrust Pay</h1>
  <p>Plateforme financière sécurisée</p>
</header>

<nav>
  <a onclick="showSection('home')">Accueil</a>
  <a onclick="showSection('login')">Connexion</a>
  <a onclick="showSection('contact')">Contact</a>
  <a onclick="showSection('about')">Qui sommes-nous ?</a>
  <a onclick="showSection('services')">Services</a>
  <a onclick="showSection('partners')">Partenaires</a>
</nav>

<main>
<!-- Sections identiques à ton fichier actuel -->
<div class="section" id="home">
  <h2>Bienvenue sur GoTrust Pay</h2>
  <p>Plateforme sécurisée pour vos dépôts, retraits et paiements.</p>
</div>

<div class="section hidden" id="login">
  <h2>Connexion / Inscription</h2>
  <label>Statut</label>
  <select id="loginStatus"><option value="client">Client</option><option value="admin">Administrateur</option></select>
  <input type="text" id="loginId" placeholder="ID">
  <input type="password" id="loginPassword" placeholder="Mot de passe">
  <button onclick="login()">Se connecter</button>

  <h3>Créer un compte client</h3>
  <input type="text" id="regName" placeholder="Nom complet">
  <input type="email" id="regEmail" placeholder="Email">
  <input type="text" id="regPhone" placeholder="Téléphone">
  <input type="password" id="regPassword" placeholder="Mot de passe">
  <input type="text" id="regCode" placeholder="Code de retrait">
  <button onclick="register()">S'inscrire</button>
</div>

<div class="section hidden" id="clientDashboard">
  <h2>Dashboard Client</h2>
  <div class="card">
    <h3>Carte Virtuelle</h3>
    <div id="clientQR" class="qr"></div>
    <p>ID : <span id="clientIdDisplay"></span></p>
    <p>Numéro de carte : <span id="clientCardNumber"></span></p>
    <p>Solde : <span id="clientBalance"></span></p>
    <button onclick="downloadQR()">Télécharger QR</button>
  </div>
  <div class="menu">
    <button onclick="showClientSection('deposit')">Déposer</button>
    <button onclick="showClientSection('withdraw')">Retirer</button>
    <button onclick="showClientSection('send')">Envoyer argent</button>
    <button onclick="showClientSection('historyClient')">Historique</button>
    <button onclick="showClientSection('chatClient')">Chat</button>
  </div>
  <div id="clientActions">
    <div class="hidden" id="deposit">
      <input type="number" id="depositAmount" placeholder="Montant">
      <button onclick="deposit()">Déposer</button>
    </div>
    <div class="hidden" id="withdraw">
      <input type="number" id="withdrawAmount" placeholder="Montant">
      <button onclick="withdraw()">Retirer</button>
    </div>
    <div class="hidden" id="send">
      <input type="text" id="sendRecipient" placeholder="ID destinataire">
      <input type="number" id="sendAmount" placeholder="Montant">
      <button onclick="sendMoney()">Envoyer</button>
    </div>
    <div class="hidden" id="historyClient"><div id="historyListClient"></div></div>
    <div class="hidden" id="chatClient">
      <input type="text" id="chatMsg" placeholder="Écrire message">
      <button onclick="sendChat()">Envoyer</button>
      <div id="chatBox"></div>
    </div>
  </div>
</div>

<div class="section hidden" id="adminDashboard">
  <h2>Dashboard Admin</h2>
  <div class="menu">
    <button onclick="showAdminSection('clientsAdmin')">Clients</button>
    <button onclick="showAdminSection('historyAdmin')">Historique</button>
    <button onclick="showAdminSection('chatAdmin')">Chat</button>
  </div>
  <div id="adminActions">
    <div class="hidden" id="clientsAdmin"><div id="clientsList"></div></div>
    <div class="hidden" id="historyAdmin"><div id="historyList"></div></div>
    <div class="hidden" id="chatAdmin"><div id="chatBoxAdmin"></div></div>
  </div>
</div>

<div class="section hidden" id="contact"><h2>Contact</h2><p>Email: gotrustpayinfo@gmail.com</p></div>
<div class="section hidden" id="about"><h2>Qui sommes-nous ?</h2><p>GoTrust Pay...</p></div>
<div class="section hidden" id="services"><h2>Services</h2></div>
<div class="section hidden" id="partners"><h2>Partenaires</h2></div>

</main>

<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.1/build/qrcode.min.js"></script>
<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyA-p_WgDeRhaGsP0zJYmd9aIw7GwuC6k6g",
  authDomain: "gotrustpay-e6524.firebaseapp.com",
  projectId: "gotrustpay-e6524",
  storageBucket: "gotrustpay-e6524.appspot.com",
  messagingSenderId: "177034024636",
  appId: "1:177034024636:web:da80102cc82dd7cfa2a2b9"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Variables
let currentUser = null;

// Navigation
function showSection(id){ document.querySelectorAll('main .section').forEach(s=>s.classList.add('hidden')); document.getElementById(id).classList.remove('hidden');}
function showClientSection(id){ document.querySelectorAll('#clientActions > div').forEach(d=>d.classList.add('hidden')); document.getElementById(id).classList.remove('hidden');}
function showAdminSection(id){ document.querySelectorAll('#adminActions > div').forEach(d=>d.classList.add('hidden')); document.getElementById(id).classList.remove('hidden');}

// Inscription
function register(){
  const name=document.getElementById('regName').value;
  const email=document.getElementById('regEmail').value;
  const phone=document.getElementById('regPhone').value;
  const password=document.getElementById('regPassword').value;
  const code=document.getElementById('regCode').value;
  if(!name||!email||!phone||!password||!code){alert('Remplir tous les champs'); return;}
  const id=Date.now().toString();
  currentUser={id,name,email,phone,password,code,balance:0};
  db.collection('users').doc(id).set(currentUser).then(()=>{ alert('Compte créé ID:'+id); updateClientDashboard(); showSection('clientDashboard');});
}

// Connexion
function login(){
  const status=document.getElementById('loginStatus').value;
  const id=document.getElementById('loginId').value;
  const pwd=document.getElementById('loginPassword').value;
  if(status==='admin' && id==='gopay' && pwd==='admin243'){ currentUser={id:'gopay',name:'Admin'}; showSection('adminDashboard'); loadAdminData(); return;}
  db.collection('users').doc(id).get().then(doc=>{
    if(!doc.exists || doc.data().password!==pwd){alert('ID ou mot de passe incorrect'); return;}
    currentUser=doc.data(); currentUser.id=doc.id; updateClientDashboard(); showSection('clientDashboard');
  });
}

// Mise à jour dashboard client
function updateClientDashboard(){
  document.getElementById('clientIdDisplay').textContent=currentUser.id;
  document.getElementById('clientCardNumber').textContent=currentUser.cardNumber||currentUser.id;
  document.getElementById('clientBalance').textContent=(currentUser.balance||0).toFixed(2)+' USD';
  QRCode.toCanvas(document.getElementById('clientQR'), currentUser.id);
  loadHistory();
  loadChat();
}

// Dépôt
function deposit(){
  const amt=parseFloat(document.getElementById('depositAmount').value);
  if(!amt || amt<=0){alert('Montant invalide'); return;}
  currentUser.balance=(currentUser.balance||0)+amt;
  db.collection('users').doc(currentUser.id).update({balance: currentUser.balance});
  db.collection('history').add({user:currentUser.id,type:'dépôt',amount:amt,date:new Date()});
  updateClientDashboard(); alert('Dépôt effectué');
}

// Retrait
function withdraw(){
  const amt=parseFloat(document.getElementById('withdrawAmount').value);
  if(!amt || amt<=0){alert('Montant invalide'); return;}
  if(currentUser.balance<amt){alert('Solde insuffisant'); return;}
  currentUser.balance-=amt;
  db.collection('users').doc(currentUser.id).update({balance: currentUser.balance});
  db.collection('history').add({user:currentUser.id,type:'retrait',amount:amt,date:new Date()});
  updateClientDashboard(); alert('Retrait effectué');
}

// Envoyer argent
function sendMoney(){
  const amt=parseFloat(document.getElementById('sendAmount').value);
  const recipient=document.getElementById('sendRecipient').value;
  if(!amt || amt<=0){alert('Montant invalide'); return;}
  db.collection('users').doc(recipient).get().then(doc=>{
    if(!doc.exists){alert('Destinataire introuvable'); return;}
    if(currentUser.balance<amt){alert('Solde insuffisant'); return;}
    currentUser.balance-=amt;
    db.collection('users').doc(currentUser.id).update({balance: currentUser.balance});
    const recData=doc.data(); recData.balance=(recData.balance||0)+amt;
    db.collection('users').doc(recipient).update({balance: recData.balance});
    db.collection('history').add({user:currentUser.id,to:recipient,type:'envoi',amount:amt,date:new Date()});
    updateClientDashboard(); alert('Envoi effectué');
  });
}

// Historique client
function loadHistory(){
  const histDiv=document.getElementById('historyListClient');
  histDiv.innerHTML='';
  db.collection('history').where('user','==',currentUser.id).orderBy('date','desc').onSnapshot(snap=>{
    histDiv.innerHTML='';
    snap.forEach(doc=>{const h=doc.data(); histDiv.innerHTML+=`<div class="card">${h.type} - ${h.amount||0} - ${h.date.toDate().toLocaleString()}</div>`;});
  });
}

// Chat simple
function sendChat(){
  const msg=document.getElementById('chatMsg').value;
  if(!msg) return;
  db.collection('chat').add({from:currentUser.id,msg,date:new Date()});
  document.getElementById('chatMsg').value='';
}
function loadChat(){
  const box=document.getElementById('chatBox');
  box.innerHTML='';
  db.collection('chat').orderBy('date','asc').onSnapshot(snap=>{
    box.innerHTML='';
    snap.forEach(doc=>{const m=doc.data(); box.innerHTML+=`<div class="message"><b>${m.from}</b>: ${m.msg}</div>`;});
  });
}

// Admin
function loadAdminData(){
  db.collection('users').onSnapshot(snap=>{
    const div=document.getElementById('clientsList'); div.innerHTML='';
    snap.forEach(doc=>{const u=doc.data(); div.innerHTML+=`<div class="card">${u.name} - ID:${doc.id} - Solde:${u.balance||0}</div>`;});
  });
  db.collection('history').orderBy('date','desc').onSnapshot(snap=>{
    const div=document.getElementById('historyList'); div.innerHTML='';
    snap.forEach(doc=>{const h=doc.data(); div.innerHTML+=`<div class="card">${h.user} ${h.type} ${h.amount||0} à ${(h.to||'-')} - ${h.date.toDate().toLocaleString()}</div>`;});
  });
  db.collection('chat').orderBy('date','asc').onSnapshot(snap=>{
    const div=document.getElementById('chatBoxAdmin'); div.innerHTML='';
    snap.forEach(doc=>{const m=doc.data(); div.innerHTML+=`<div class="message"><b>${m.from}</b>: ${m.msg}</div>`;});
  });
}

// Télécharger QR
function downloadQR(){
  const canvas=document.querySelector('#clientQR canvas');
  const link=document.createElement('a');
  link.download='qr_'+currentUser.id+'.png';
  link.href=canvas.toDataURL();
  link.click();
}
</script>
</body>
</html>
