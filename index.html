<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>GoPay Africa</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

<style>
body{margin:0;font-family:Roboto;background:#061e1c;color:#e6fffa}
header{background:#012b28;padding:15px 20px;display:flex;justify-content:space-between;align-items:center}
.logo{font-size:22px;font-weight:700}
.menu-btn{font-size:28px;cursor:pointer}
.menu{display:none;position:absolute;top:60px;right:20px;background:#043837;border-radius:12px;overflow:hidden;z-index:100}
.menu a{display:block;padding:12px 18px;color:#5eead4;text-decoration:none;cursor:pointer}
.menu a:hover{background:#065f5b}

main{max-width:1000px;margin:auto;padding:20px}
.panel{background:#043837;padding:20px;border-radius:18px;margin-top:20px}
.hidden{display:none}

/* CARD */
.card{
background:linear-gradient(135deg,#0f766e,#064e4b);
border-radius:20px;padding:25px;
box-shadow:0 20px 40px rgba(0,0,0,.6);
cursor:pointer;
transition:.6s;
transform-style:preserve-3d
}
.card.flip{transform:rotateY(180deg)}
.card h2{margin:0}
.card-number{font-size:22px;letter-spacing:3px;margin:15px 0}
.card-row{display:flex;justify-content:space-between;font-size:14px}

.actions{display:grid;grid-template-columns:repeat(3,1fr);gap:15px;margin-top:20px}
.action{background:#14b8a6;padding:15px;border-radius:14px;text-align:center;font-weight:700;cursor:pointer}
.action:hover{background:#2dd4bf}

.tx{background:#065f5b;padding:10px;border-radius:10px;margin-bottom:8px;font-size:14px}

table{width:100%;border-collapse:collapse;margin-top:10px}
th,td{border:1px solid #065f5b;padding:8px}
th{background:#0d9488}

input,button{
width:100%;
padding:10px;
margin-top:10px;
border-radius:10px;
border:none;
font-family:Roboto
}
button{background:#14b8a6;font-weight:700;cursor:pointer}
button:hover{background:#2dd4bf}

footer{text-align:center;margin-top:30px;font-size:14px;opacity:.8}
footer a{color:#5eead4;cursor:pointer}
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
</head>

<body>

<header>
<div class="logo">GoPay Africa</div>
<div class="menu-btn" onclick="toggleMenu()">‚ò∞</div>
</header>

<div class="menu" id="menu">
<a onclick="show('home')">Accueil</a>
<a onclick="show('login')">Connexion</a>
<a onclick="show('register')">Cr√©er un compte</a>
<a onclick="logout()">D√©connexion</a>
</div>

<main>

<div id="home" class="panel">
<h2>Payments for a Connected Africa</h2>
<p>Paiements digitaux s√©curis√©s et fiables.</p>
</div>

<div id="login" class="panel hidden">
<h3>Connexion</h3>
<input id="lEmail" placeholder="Email">
<input id="lPass" type="password" placeholder="Mot de passe">
<button onclick="login()">Se connecter</button>
</div>

<div id="register" class="panel hidden">
<h3>Inscription</h3>
<input id="rName" placeholder="Nom complet">
<input id="rEmail" placeholder="Email">
<input id="rPass" type="password" placeholder="Mot de passe">
<button onclick="register()">Cr√©er un compte</button>
</div>

<div id="dash" class="hidden">

<div class="card" id="card">
<h2>GoPay ‚Ä¢ VIRTUAL</h2>
<div class="card-number" id="cardId"></div>
<div class="card-row">
<span>TITULAIRE</span><span>EXP</span>
</div>
<div class="card-row">
<strong id="cardName"></strong><strong>12/29</strong>
</div>
<p>SOLDE : <b><span id="balance"></span> USD</b></p>
</div>

<div class="actions">
<div class="action" onclick="openP('pay')">üí≥ Paiement</div>
<div class="action" onclick="openP('cashin')">‚ûï Cash-in</div>
<div class="action" onclick="openP('cashout')">‚ûñ Cash-out</div>
</div>

<div id="pay" class="panel hidden">
<input id="payId" placeholder="ID GoPay destinataire" oninput="fetchRecipientName('pay')">
<input id="payName" placeholder="Nom destinataire" disabled>
<input id="payAmount" type="number" placeholder="Montant USD">
<button onclick="pay()">Confirmer</button>
</div>

<div id="cashin" class="panel hidden">
<input id="cinAmount" type="number" placeholder="Montant USD">
<button onclick="cashin()">Valider</button>
</div>

<div id="cashout" class="panel hidden">
<input id="coutId" placeholder="ID GoPay destinataire" oninput="fetchRecipientName('cout')">
<input id="coutName" placeholder="Nom destinataire" disabled>
<input id="coutAmount" type="number" placeholder="Montant USD">
<button onclick="cashout()">Confirmer</button>
</div>

<div class="panel">
<h3>Activit√©s r√©centes</h3>
<div id="myTx"></div>
</div>

<div id="admin" class="panel hidden">
<h3>ADMIN ‚Äì Vue globale</h3>
<table id="usersTable">
<tr><th>Nom</th><th>R√¥le</th><th>Solde</th><th>Actif</th></tr>
</table>
<h4>Activit√©s globales</h4>
<div id="globalTx"></div>
</div>

<div id="legal" class="panel hidden">
<h3>Mentions l√©gales</h3>
<p>GoPay Africa ‚Äì plateforme de paiement digital s√©curis√©.</p>
</div>

<div id="privacy" class="panel hidden">
<h3>Politique de confidentialit√©</h3>
<p>Les donn√©es utilisateurs sont strictement prot√©g√©es.</p>
</div>

</div>
</main>

<footer>
¬© 2026 GoPay Africa ‚Äî
<a onclick="show('legal')">Mentions l√©gales</a> |
<a onclick="show('privacy')">Politique de confidentialit√©</a>
</footer>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyA-p_WgDeRhaGsP0zJYmd9aIw7GwuC6k6g",
 authDomain:"gotrustpay-e6524.firebaseapp.com",
 projectId:"gotrustpay-e6524"
});
const auth=firebase.auth(),db=firebase.firestore();

function toggleMenu(){
 menu.style.display=menu.style.display==="block"?"none":"block";
}

function show(id){
 document.querySelectorAll(".panel,#dash,#admin,#legal,#privacy")
 .forEach(d=>d.classList.add("hidden"));
 const el=document.getElementById(id);
 if(el) el.classList.remove("hidden");
 menu.style.display="none";
}

function openP(id){
 ["pay","cashin","cashout"].forEach(x=>{
  const e=document.getElementById(x);
  if(e) e.classList.add("hidden");
 });
 document.getElementById(id).classList.remove("hidden");
}

function genId(){
 return "GP-"+Math.random().toString(36).substr(2,8).toUpperCase();
}

function register(){
 if(!rName.value||!rEmail.value||!rPass.value)
  return alert("Veuillez remplir tous les champs");
 auth.createUserWithEmailAndPassword(rEmail.value,rPass.value).then(c=>{
  db.collection("users").doc(c.user.uid).set({
   name:rName.value,
   gid:genId(),
   role:"user",
   balance:50,
   active:true
  }).then(()=>alert("Compte cr√©√© avec succ√®s"));
 });
}

function login(){
 auth.signInWithEmailAndPassword(lEmail.value,lPass.value).then(async ()=>{
  const snap=await db.collection("users").doc(auth.currentUser.uid).get();
  updateCard(snap.data());
  show("dash");
  loadMyTx();
 });
}

function logout(){
 auth.signOut();
 show("home");
}

function updateCard(d){
 cardName.textContent=d.name;
 cardId.textContent=d.gid;
 balance.textContent=d.balance.toFixed(2);
}

document.getElementById("card").onclick=()=>{
 document.getElementById("card").classList.toggle("flip");
};

async function fetchRecipientName(type){
 const id=(type==="pay")?payId.value:coutId.value;
 const field=(type==="pay")?payName:coutName;
 if(!id){field.value="";return;}
 const q=await db.collection("users").where("gid","==",id).get();
 field.value=q.empty?"ID invalide":q.docs[0].data().name;
}

async function pay(){
 const amount=parseFloat(payAmount.value);
 if(amount<=0)return;
 const dest=await db.collection("users").where("gid","==",payId.value).get();
 if(dest.empty)return alert("ID invalide");
 const me=await db.collection("users").doc(auth.currentUser.uid).get();
 if(me.data().balance<amount)return alert("Solde insuffisant");

 await db.collection("users").doc(auth.currentUser.uid)
 .update({balance:firebase.firestore.FieldValue.increment(-amount)});
 await db.collection("users").doc(dest.docs[0].id)
 .update({balance:firebase.firestore.FieldValue.increment(amount)});
 await db.collection("tx").add({
  from:me.data().gid,
  to:payId.value,
  type:"Paiement",
  amount:amount,
  date:new Date()
 });
 loadMyTx();
}

async function cashin(){
 const amount=parseFloat(cinAmount.value);
 if(amount<=0)return;
 await db.collection("users").doc(auth.currentUser.uid)
 .update({balance:firebase.firestore.FieldValue.increment(amount)});
 await db.collection("tx").add({
  type:"Cash-in",
  amount:amount,
  date:new Date()
 });
 loadMyTx();
}

async function cashout(){
 const amount=parseFloat(coutAmount.value);
 if(amount<=0)return;
 const dest=await db.collection("users").where("gid","==",coutId.value).get();
 if(dest.empty)return alert("ID invalide");
 const me=await db.collection("users").doc(auth.currentUser.uid).get();
 if(me.data().balance<amount)return alert("Solde insuffisant");

 await db.collection("users").doc(auth.currentUser.uid)
 .update({balance:firebase.firestore.FieldValue.increment(-amount)});
 await db.collection("users").doc(dest.docs[0].id)
 .update({balance:firebase.firestore.FieldValue.increment(amount)});
 await db.collection("tx").add({
  from:me.data().gid,
  to:coutId.value,
  type:"Cash-out",
  amount:amount,
  date:new Date()
 });
 loadMyTx();
}

async function loadMyTx(){
 myTx.innerHTML="";
 const snap=await db.collection("tx")
 .where("from","==",cardId.textContent)
 .orderBy("date","desc")
 .limit(5).get();
 snap.forEach(d=>{
  const t=d.data();
  myTx.innerHTML+=`<div class="tx">${t.type} ‚Ä¢ ${t.amount} USD</div>`;
 });
}
</script>

</body>
</html>
