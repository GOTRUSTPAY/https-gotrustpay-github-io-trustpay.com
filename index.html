<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>GoPay Africa</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- Font -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">

<style>
body{
 margin:0;
 font-family:'Roboto',Arial;
 background:#061e1c;
 color:#e6fffa;
}

/* HEADER */
header{
 display:flex;
 justify-content:space-between;
 align-items:center;
 padding:15px 20px;
 background:#012b28;
 box-shadow:0 2px 10px rgba(0,0,0,.4);
}
.logo{
 font-size:20px;
 font-weight:700;
 letter-spacing:1px;
}
.menu-btn{
 font-size:26px;
 cursor:pointer;
}

/* MENU DROPDOWN */
.menu{
 position:absolute;
 top:60px;
 right:20px;
 background:#043837;
 border-radius:12px;
 overflow:hidden;
 display:none;
}
.menu a{
 display:block;
 padding:12px 18px;
 text-decoration:none;
 color:#5eead4;
 font-weight:500;
}
.menu a:hover{background:#065f5b}

/* MAIN */
main{max-width:900px;margin:auto;padding:20px}
.hidden{display:none}

/* PANELS */
.panel{
 background:#043837;
 padding:20px;
 border-radius:18px;
 margin-top:20px;
}

/* CARD */
.bank-card{
 background:linear-gradient(135deg,#064e4b,#0f766e);
 border-radius:22px;
 padding:25px;
 display:flex;
 justify-content:space-between;
 align-items:center;
 box-shadow:0 15px 40px rgba(0,0,0,.6);
 margin-top:20px;
}
.card-left h3{margin:0;font-weight:500}
.card-left h1{margin:10px 0;font-size:28px}
.card-left small{opacity:.8}
.card-qr{
 background:#fff;
 padding:10px;
 border-radius:12px;
}

/* ACTIONS */
.actions{
 display:grid;
 grid-template-columns:repeat(4,1fr);
 gap:15px;
 margin-top:25px;
}
.action{
 background:#0d9488;
 padding:18px;
 border-radius:16px;
 text-align:center;
 font-weight:600;
 cursor:pointer;
}
.action:hover{background:#14b8a6}
@media(max-width:600px){
 .actions{grid-template-columns:repeat(2,1fr)}
}

/* INPUTS */
input,select,button{
 width:100%;
 padding:14px;
 margin:8px 0;
 border:none;
 border-radius:12px;
 font-size:15px;
}
button{
 background:#14b8a6;
 font-weight:700;
 cursor:pointer;
}

/* TX */
.tx{
 background:#065f5b;
 padding:10px;
 border-radius:10px;
 margin-bottom:8px;
}
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>

<body>

<header>
 <div class="logo">GoPay Africa</div>
 <div class="menu-btn" onclick="toggleMenu()">â‹®</div>
</header>

<div class="menu" id="menu">
 <a onclick="show('home')">Accueil</a>
 <a onclick="show('login')">Connexion</a>
 <a onclick="show('register')">Inscription</a>
 <a onclick="logout()">DÃ©connexion</a>
</div>

<main>

<div id="home" class="panel">
<h2>Payments for a Connected Africa</h2>
<p>Paiements digitaux sÃ©curisÃ©s, transparents et fiables.</p>
</div>

<div id="login" class="panel hidden">
<h3>Connexion</h3>
<input id="lEmail" placeholder="Email">
<input id="lPass" type="password" placeholder="Mot de passe">
<button onclick="login()">Se connecter</button>
</div>

<div id="register" class="panel hidden">
<h3>Inscription</h3>
<input id="rName" placeholder="Nom complet">
<input id="rPhone" placeholder="TÃ©lÃ©phone">
<input id="rEmail" placeholder="Email">
<input id="rPass" type="password" placeholder="Mot de passe">
<select id="rRole">
 <option value="user">Utilisateur</option>
 <option value="agent">Agent GoPay</option>
</select>
<button onclick="register()">CrÃ©er le compte</button>
</div>

<div id="dash" class="hidden">

<div class="bank-card">
 <div class="card-left">
  <h3 id="uName"></h3>
  <small>ID GoPay</small>
  <div><b id="uId"></b></div>
  <h1><span id="uBal"></span> USD</h1>
  <small>Carte digitale sÃ©curisÃ©e</small>
 </div>
 <div class="card-qr" id="qr"></div>
</div>

<div class="actions">
 <div class="action" id="payBtn" onclick="openP('pay')">ðŸ’³ Paiement</div>
 <div class="action hidden" id="cashinBtn" onclick="openP('cashin')">âž• Cashâ€‘in</div>
 <div class="action hidden" id="cashoutBtn" onclick="openP('cashout')">âž– Cashâ€‘out</div>
 <div class="action" onclick="openP('history')">ðŸ“œ Historique</div>
</div>

<div id="pay" class="panel hidden">
<input id="payTo" placeholder="ID destinataire">
<input id="payAmount" type="number" placeholder="Montant USD">
<button onclick="pay()">Payer</button>
</div>

<div id="cashin" class="panel hidden">
<input id="cinAmount" type="number" placeholder="Montant USD">
<button onclick="cashin()">Valider</button>
</div>

<div id="cashout" class="panel hidden">
<input id="coutAmount" type="number" placeholder="Montant USD">
<button onclick="cashout()">Valider</button>
</div>

<div id="history" class="panel hidden">
<div id="txs"></div>
</div>

</div>
</main>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyA-p_WgDeRhaGsP0zJYmd9aIw7GwuC6k6g",
 authDomain:"gotrustpay-e6524.firebaseapp.com",
 projectId:"gotrustpay-e6524"
});
const auth=firebase.auth(),db=firebase.firestore();

function toggleMenu(){menu.style.display=menu.style.display=="block"?"none":"block"}
function show(id){
 document.querySelectorAll("main>div").forEach(x=>x.classList.add("hidden"));
 document.getElementById(id).classList.remove("hidden");
 menu.style.display="none";
}
function openP(id){
 ["pay","cashin","cashout","history"].forEach(x=>document.getElementById(x).classList.add("hidden"));
 document.getElementById(id).classList.remove("hidden");
}

function genId(){return "GP-"+Math.random().toString(36).substr(2,8).toUpperCase()}

function register(){
 auth.createUserWithEmailAndPassword(rEmail.value,rPass.value).then(c=>{
  db.collection("users").doc(c.user.uid).set({
   name:rName.value,phone:rPhone.value,
   role:rRole.value,gid:genId(),balance:50
  });
 });
}
function login(){auth.signInWithEmailAndPassword(lEmail.value,lPass.value)}
function logout(){auth.signOut()}

auth.onAuthStateChanged(async u=>{
 if(!u){show("home");return}
 const d=await db.collection("users").doc(u.uid).get();
 const x=d.data();
 show("dash");
 uName.textContent=x.name+" ("+x.role+")";
 uId.textContent=x.gid;
 uBal.textContent=x.balance.toFixed(2);
 qr.innerHTML="";new QRCode(qr,{text:x.gid,width:120,height:120});

 if(x.role==="agent"){
  cashinBtn.classList.remove("hidden");
  cashoutBtn.classList.remove("hidden");
  payBtn.classList.add("hidden");
 }
 loadTx();
});

function tx(type,amount){
 db.collection("transactions").add({
  uid:auth.currentUser.uid,type,amount,date:new Date()
 });
}

function pay(){
 db.collection("users").doc(auth.currentUser.uid)
 .update({balance:firebase.firestore.FieldValue.increment(-payAmount.value)});
 tx("Paiement",-payAmount.value);
}
function cashin(){
 db.collection("users").doc(auth.currentUser.uid)
 .update({balance:firebase.firestore.FieldValue.increment(+cinAmount.value)});
 tx("Cashâ€‘in",+cinAmount.value);
}
function cashout(){
 db.collection("users").doc(auth.currentUser.uid)
 .update({balance:firebase.firestore.FieldValue.increment(-coutAmount.value)});
 tx("Cashâ€‘out",-coutAmount.value);
}
async function loadTx(){
 txs.innerHTML="";
 const q=await db.collection("transactions")
 .where("uid","==",auth.currentUser.uid)
 .orderBy("date","desc").limit(10).get();
 q.forEach(d=>{
  const t=d.data();
  txs.innerHTML+=`<div class="tx">${t.type} : ${t.amount} USD</div>`;
 });
}
</script>

</body>
</html>
