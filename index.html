<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GoTrust Pay</title>

<style>
body{margin:0;font-family:Arial;background:#f5f5f5}
header{background:#0a74da;color:#fff;padding:20px;text-align:center}
nav{display:flex;gap:15px;justify-content:center;background:#0073c2;padding:10px;flex-wrap:wrap}
nav a{color:#fff;text-decoration:none;font-weight:bold}
main{max-width:1000px;margin:20px auto;background:#fff;padding:20px;border-radius:10px}
.hidden{display:none}
.card{background:#f9f9f9;border:1px solid #ddd;padding:15px;margin-bottom:10px;border-radius:8px}
button{background:#0a74da;color:#fff;border:none;padding:10px;border-radius:5px;cursor:pointer}
input,select,textarea{width:100%;padding:10px;margin-top:5px}
.menu{display:flex;gap:10px;flex-wrap:wrap;margin-bottom:15px}
</style>
</head>

<body>

<header>
<h1>GoTrust Pay</h1>
<p>Plateforme financière sécurisée</p>
</header>

<nav>
<a href="#" onclick="showSection('home')">Accueil</a>
<a href="#" onclick="showSection('login')">Connexion</a>
</nav>

<main>

<div id="home" class="section">
<h2>Accueil</h2>
<div id="homeMessages"></div>
</div>

<div id="login" class="section hidden">
<h2>Connexion</h2>
<select id="loginStatus">
<option value="client">Client</option>
<option value="admin">Admin</option>
</select>
<input id="loginId" placeholder="ID">
<input id="loginPassword" type="password" placeholder="Mot de passe">
<button onclick="login()">Connexion</button>

<hr>

<h3>Créer compte client</h3>
<input id="regName" placeholder="Nom">
<input id="regEmail" placeholder="Email">
<input id="regPhone" placeholder="Téléphone">
<input id="regPassword" type="password" placeholder="Mot de passe">
<input id="regCode" placeholder="Code retrait">
<button onclick="register()">Créer compte</button>
</div>

<div id="clientDashboard" class="section hidden">
<h2>Client</h2>
<div class="card">
ID: <span id="cid"></span><br>
Solde: <span id="cbalance"></span>
</div>

<div class="menu">
<button onclick="showClient('send')">Envoyer</button>
<button onclick="showClient('history')">Historique</button>
<button onclick="showClient('chat')">Messages</button>
</div>

<div id="send" class="hidden">
<input id="sendTo" placeholder="ID destinataire">
<input id="sendAmount" type="number" placeholder="Montant">
<button onclick="sendMoney()">Envoyer</button>
</div>

<div id="history" class="hidden">
<div id="clientHistory"></div>
</div>

<div id="chat" class="hidden">
<div id="clientChat"></div>
<input id="chatMsg">
<button onclick="sendChat()">Envoyer</button>
</div>
</div>

<div id="adminDashboard" class="section hidden">
<h2>Admin</h2>

<div class="menu">
<button onclick="showAdmin('publish')">Publier</button>
<button onclick="showAdmin('history')">Historique</button>
<button onclick="showAdmin('chat')">Messages</button>
</div>

<div id="publish" class="hidden">
<textarea id="adminMessage"></textarea>
<button onclick="publish()">Publier</button>
</div>

<div id="historyAdmin" class="hidden">
<div id="adminHistory"></div>
</div>

<div id="chatAdmin" class="hidden">
<div id="adminChat"></div>
<input id="adminChatMsg">
<button onclick="sendAdminChat()">Envoyer</button>
</div>

</div>

</main>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const firebaseConfig={
apiKey:"AIzaSyA-p_WgDeRhaGsP0zJYmd9aIw7GwuC6k6g",
authDomain:"gotrustpay-e6524.firebaseapp.com",
projectId:"gotrustpay-e6524",
storageBucket:"gotrustpay-e6524.firebasestorage.app",
messagingSenderId:"177034024636",
appId:"1:177034024636:web:da80102cc82dd7cfa2a2b9"
};

const app=initializeApp(firebaseConfig);
const db=getFirestore(app);

window.db=db;
window.addDoc=addDoc;
window.collection=collection;
window.onSnapshot=onSnapshot;
window.query=query;
window.orderBy=orderBy;
</script>

<script>
let currentUser=null;

function showSection(id){
document.querySelectorAll('.section').forEach(s=>s.classList.add('hidden'));
document.getElementById(id).classList.remove('hidden');
}

function showClient(id){
['send','history','chat'].forEach(x=>document.getElementById(x).classList.add('hidden'));
document.getElementById(id).classList.remove('hidden');
}

function showAdmin(id){
['publish','historyAdmin','chatAdmin'].forEach(x=>document.getElementById(x).classList.add('hidden'));
document.getElementById(id).classList.remove('hidden');
}

function register(){
currentUser={id:Date.now(),name:regName.value,balance:0};
showSection('clientDashboard');
document.getElementById('cid').textContent=currentUser.id;
document.getElementById('cbalance').textContent='0 USD';
}

function login(){
if(loginStatus.value==='admin' && loginId.value==='gopay' && loginPassword.value==='admin243'){
showSection('adminDashboard');
loadHistoryAdmin();
loadAdminChat();
}else{
alert('Connexion admin uniquement');
}
}

function sendMoney(){
let amt=Number(sendAmount.value);
currentUser.balance-=amt;
cbalance.textContent=currentUser.balance+' USD';
addDoc(collection(db,'history'),{user:currentUser.id,amount:amt,type:'envoi',time:new Date()});
}

function publish(){
addDoc(collection(db,'annonces'),{msg:adminMessage.value,time:new Date()});
alert('Publié');
}

function loadHome(){
onSnapshot(query(collection(db,'annonces'),orderBy('time','desc')),s=>{
homeMessages.innerHTML='';
s.forEach(d=>homeMessages.innerHTML+=`<div class="card">${d.data().msg}</div>`);
});
}
loadHome();

function loadHistoryAdmin(){
onSnapshot(query(collection(db,'history'),orderBy('time','desc')),s=>{
adminHistory.innerHTML='';
s.forEach(d=>adminHistory.innerHTML+=`<div>${JSON.stringify(d.data())}</div>`);
});
}

function sendChat(){
addDoc(collection(db,'messages'),{from:currentUser.id,msg:chatMsg.value,time:new Date()});
}

function loadAdminChat(){
onSnapshot(query(collection(db,'messages'),orderBy('time')),s=>{
adminChat.innerHTML='';
s.forEach(d=>adminChat.innerHTML+=`<div>${d.data().from}: ${d.data().msg}</div>`);
});
}

function sendAdminChat(){
addDoc(collection(db,'messages'),{from:'ADMIN',msg:adminChatMsg.value,time:new Date()});
}
</script>

</body>
</html>
