<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>GOPAY AFRICA</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{margin:0;font-family:Arial;background:linear-gradient(135deg,#021c1b,#032f2e);color:#d1fae5}
.hidden{display:none!important}
header{padding:15px;background:#021c1b}
nav a{margin-right:15px;color:#99f6e4;font-weight:bold;cursor:pointer}
main{max-width:1100px;margin:auto;padding:20px}
input,select,button{width:100%;padding:12px;margin:6px 0;border-radius:10px;border:none}
button{background:#14b8a6;font-weight:bold;cursor:pointer}
.panel{background:#043837;padding:20px;border-radius:16px;margin-top:20px}
.card{background:#054f4b;padding:20px;border-radius:18px;display:flex;justify-content:space-between;flex-wrap:wrap}
#qr{width:120px;height:120px;background:#fff;padding:6px;border-radius:10px}
.actions{display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-top:20px}
.action{background:#0fb9a8;padding:20px;border-radius:16px;text-align:center;font-weight:bold;cursor:pointer}
.tx{background:#022c2a;padding:8px;border-radius:8px;margin-bottom:6px}
small{opacity:.7}
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
</head>

<body>

<header>
<nav>
 <a onclick="show('home')">Accueil</a>
 <a id="loginBtn" onclick="show('login')">Connexion</a>
 <a id="registerBtn" onclick="show('register')">Inscription</a>
 <a id="logoutBtn" class="hidden" onclick="auth.signOut()">D√©connexion</a>
</nav>
</header>

<main>

<div id="home" class="panel">
<h2>GOPAY AFRICA</h2>
<p>Paiement digital accessible √† tous</p>
<small>Version pilote ‚Äì transactions simul√©es</small>
</div>

<div id="login" class="panel hidden">
<input id="loginEmail" placeholder="Email">
<input id="loginPassword" type="password" placeholder="Mot de passe">
<button onclick="login()">Connexion</button>
</div>

<div id="register" class="panel hidden">
<input id="regName" placeholder="Nom complet">
<input id="regPhone" placeholder="T√©l√©phone">
<input id="regEmail" placeholder="Email">
<input id="regPassword" type="password" placeholder="Mot de passe">
<button onclick="register()">Cr√©er mon compte</button>
</div>

<div id="dashboard" class="hidden">

<div class="card">
<div>
<h3 id="name"></h3>
<p>ID GoPay : <b id="gid"></b></p>
<b id="card"></b>
<h2>Solde : <span id="bal"></span> USD</h2>
<small>Simulation</small>
</div>
<div id="qr"></div>
</div>

<h3>Activit√©s r√©centes</h3>
<div id="recent"></div>

<div class="actions">
<div class="action" onclick="openPanel('deposit')">üí∞ D√©p√¥t</div>
<div class="action" onclick="openPanel('send')">üîÅ Envoi</div>
<div class="action" onclick="openPanel('history')">üìú Historique</div>
</div>

<div id="deposit" class="panel hidden">
<select id="depOp">
<option>Orange</option>
<option>Airtel</option>
<option>GoPay</option>
</select>
<input id="depAmt" type="number" placeholder="Montant USD">
<button onclick="deposit()">Confirmer</button>
</div>

<div id="send" class="panel hidden">
<select id="sendOp">
<option>Orange</option>
<option>Airtel</option>
<option>GoPay</option>
</select>
<input id="toGid" placeholder="ID GoPay destinataire">
<input id="sendAmt" type="number" placeholder="Montant USD">
<button onclick="send()">Envoyer</button>
</div>

<div id="history" class="panel hidden">
<div id="list"></div>
</div>

</div>
</main>

<script>
firebase.initializeApp({
 apiKey:"AIzaSyA-p_WgDeRhaGsP0zJYmd9aIw7GwuC6k6g",
 authDomain:"gotrustpay-e6524.firebaseapp.com",
 projectId:"gotrustpay-e6524"
});
const auth=firebase.auth(), db=firebase.firestore();

function show(id){
 document.querySelectorAll("main>div").forEach(d=>d.classList.add("hidden"));
 document.getElementById(id).classList.remove("hidden");
}
function openPanel(id){
 ["deposit","send","history"].forEach(x=>document.getElementById(x).classList.add("hidden"));
 document.getElementById(id).classList.remove("hidden");
}

function genCard(){return "4896 "+Math.floor(1000+Math.random()*9000)+" "+Math.floor(1000+Math.random()*9000)+" "+Math.floor(1000+Math.random()*9000);}
function genGoPayId(){return "GP-"+Math.floor(100000+Math.random()*900000);}

function register(){
 auth.createUserWithEmailAndPassword(regEmail.value,regPassword.value).then(async c=>{
  const gid=genGoPayId();
  await db.collection("users").doc(c.user.uid).set({
   name:regName.value, phone:regPhone.value,
   card:genCard(), balance:20, gopayId:gid
  });
  addTx("D√©p√¥t",20,"GoPay");
 });
}

function login(){auth.signInWithEmailAndPassword(loginEmail.value,loginPassword.value);}

function addTx(type,amount,op){
 db.collection("transactions").add({
  uid:auth.currentUser.uid,type,amount,operator:op,created:Date.now()
 });
 loadRecent(); loadHistory();
}

function deposit(){
 const amt=+depAmt.value;
 db.collection("users").doc(auth.currentUser.uid)
 .update({balance:firebase.firestore.FieldValue.increment(amt)});
 addTx("D√©p√¥t",amt,depOp.value);
}

async function send(){
 const q=await db.collection("users").where("gopayId","==",toGid.value).get();
 if(q.empty) return alert("Destinataire introuvable");
 const to=q.docs[0];
 const amt=+sendAmt.value;
 db.collection("users").doc(auth.currentUser.uid)
 .update({balance:firebase.firestore.FieldValue.increment(-amt)});
 db.collection("users").doc(to.id)
 .update({balance:firebase.firestore.FieldValue.increment(amt)});
 addTx("Envoi",-amt,sendOp.value);
}

async function loadRecent(){
 recent.innerHTML="";
 const q=await db.collection("transactions")
 .where("uid","==",auth.currentUser.uid).limit(3).get();
 q.forEach(d=>{
  const t=d.data();
  recent.innerHTML+=`<div class="tx">${t.type} ${t.amount} USD (${t.operator})</div>`;
 });
}

async function loadHistory(){
 list.innerHTML="";
 const q=await db.collection("transactions")
 .where("uid","==",auth.currentUser.uid).get();
 q.forEach(d=>{
  const t=d.data();
  list.innerHTML+=`<div class="tx">${t.type} ${t.amount} USD (${t.operator})</div>`;
 });
}

auth.onAuthStateChanged(async u=>{
 if(!u){show("home");return;}
 show("dashboard");
 loginBtn.classList.add("hidden");
 registerBtn.classList.add("hidden");
 logoutBtn.classList.remove("hidden");

 const d=await db.collection("users").doc(u.uid).get();
 const x=d.data();
 name.textContent=x.name;
 gid.textContent=x.gopayId;
 card.textContent=x.card;
 bal.textContent=x.balance.toFixed(2);
 qr.innerHTML="";
 new QRCode(qr,{text:x.gopayId,width:110,height:110});
 loadRecent(); loadHistory();
});
</script>

</body>
</html>
