<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>GoPay Africa PRO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>

<style>

/* ===== GLOBAL STYLE ===== */

body{
margin:0;
font-family:Roboto;
background:#061e1c;
color:#e6fffa;
}

/* ===== HEADER ===== */

header{
background:#012b28;
padding:15px;
display:flex;
justify-content:space-between;
align-items:center;
}

.logo{
font-size:22px;
font-weight:700;
color:#5eead4;
}

/* ===== PANELS ===== */

.panel{
background:#043837;
margin:20px;
padding:20px;
border-radius:18px;
}

.hidden{display:none;}

/* ===== BANK CARD REALISTIC ===== */

.bank-card{
width:100%;
max-width:360px;
height:200px;
border-radius:18px;
padding:20px;
background:linear-gradient(135deg,#00c6ff,#00ffb3);
color:#001f1d;
position:relative;
box-shadow:0 10px 30px rgba(0,0,0,0.4);
}

.card-chip{
width:45px;
height:35px;
background:gold;
border-radius:6px;
margin-bottom:20px;
}

.card-number{
letter-spacing:3px;
font-size:18px;
margin-top:10px;
}

.card-name{
margin-top:15px;
font-weight:bold;
}

.card-balance{
position:absolute;
bottom:20px;
right:20px;
font-size:18px;
}

/* ===== ACTION BUTTONS BANK STYLE ===== */

.actions{
display:grid;
grid-template-columns:repeat(2,1fr);
gap:12px;
margin-top:20px;
}

.action{
padding:12px;
border-radius:12px;
text-align:center;
font-weight:bold;
cursor:pointer;
background:linear-gradient(145deg,#00ffb3,#0096ff);
color:#002b29;
box-shadow:0 4px 12px rgba(0,0,0,0.3);
transition:.2s;
}

.action:hover{
transform:scale(1.05);
}

/* ===== TABLE ===== */

table{
width:100%;
margin-top:15px;
border-collapse:collapse;
}

td,th{
padding:8px;
border-bottom:1px solid #0ea19b;
}

</style>
</head>

<body>

<header>
<div class="logo">GoPay Africa PRO</div>
</header>

<!-- LOGIN -->

<div id="login" class="panel">
<h3>Connexion</h3>
<input id="lEmail" placeholder="Email"><br><br>
<input id="lPass" type="password" placeholder="Mot de passe"><br><br>
<button onclick="login()">Connexion</button>
</div>

<!-- DASHBOARD CLIENT -->

<div id="clientDash" class="panel hidden">

<div class="bank-card">

<div class="card-chip"></div>

<div class="card-number" id="cardNumber">•••• •••• •••• ••••</div>

<div class="card-name" id="cardName"></div>

<div class="card-balance">
<span id="balance"></span> USD
</div>

</div>

<div class="actions">
<div class="action" onclick="cashin()">Cash-in</div>
<div class="action" onclick="cashout()">Cash-out</div>
<div class="action" onclick="pay()">Paiement</div>
<div class="action" onclick="logout()">Déconnexion</div>
</div>

</div>

<!-- DASHBOARD AGENT -->

<div id="agentDash" class="panel hidden">

<h3>Agent Terrain</h3>

<p>Commission Totale : <b id="agentCommission">0</b> USD</p>

<input id="agentClientUID" placeholder="UID Client">
<input id="agentAmount" placeholder="Montant">

<button onclick="agentDeposit()">Dépôt Client</button>
<button onclick="agentWithdraw()">Retrait Client</button>

</div>

<!-- ADMIN DASHBOARD -->

<div id="adminDash" class="panel hidden">

<h3>Admin Analytics</h3>

<p>Total Transactions : <span id="totalTx">0</span></p>
<p>Commission Bureau : <span id="officeCommission">0</span></p>

<table id="usersTable"></table>

</div>

<script>

/* ===== FIREBASE ===== */

firebase.initializeApp({
apiKey:"YOUR_KEY",
authDomain:"YOUR_DOMAIN",
projectId:"YOUR_PROJECT"
});

const auth=firebase.auth();
const db=firebase.firestore();

let currentUser=null;

/* ===== UNIQUE ID ===== */

function generateUserID(){
return "GP"+Math.floor(100000+Math.random()*900000);
}

/* ===== DOUBLE SIGNATURE ===== */

function verifyDoubleSignature(pin,otp){
return pin.length===4 && otp.length===6;
}

/* ===== LOGIN ===== */

async function login(){

const cred=await auth.signInWithEmailAndPassword(lEmail.value,lPass.value);

const snap=await db.collection("users").doc(cred.user.uid).get();

loadUser(snap.data());

}

/* ===== LOAD USER ROLE ===== */

function loadUser(data){

currentUser=data;

cardName.innerText=data.name;
balance.innerText=data.balance.toFixed(2);

cardNumber.innerText="5314 •••• •••• "+data.gid.slice(-4);

if(data.role==="client") show("clientDash");
if(data.role==="agent") show("agentDash");
if(data.role==="admin") loadAdmin();

}

/* ===== SHOW PANEL ===== */

function show(id){
document.querySelectorAll(".panel").forEach(p=>p.classList.add("hidden"));
document.getElementById(id).classList.remove("hidden");
}

/* ===== CLIENT TRANSACTIONS ===== */

async function cashin(){

let amt=parseFloat(prompt("Montant"));

await db.collection("users").doc(auth.currentUser.uid)
.update({balance:firebase.firestore.FieldValue.increment(amt)});

}

async function cashout(){

let amt=parseFloat(prompt("Montant"));
let pin=prompt("PIN");
let otp=prompt("OTP");

if(!verifyDoubleSignature(pin,otp)) return alert("Erreur sécurité");

await db.collection("users").doc(auth.currentUser.uid)
.update({balance:firebase.firestore.FieldValue.increment(-amt)});

saveCommission(amt);

}

/* ===== AGENT SYSTEM ===== */

async function agentDeposit(){

let uid=agentClientUID.value;
let amt=parseFloat(agentAmount.value);

const clientRef=await findUserByUID(uid);

await db.collection("users").doc(clientRef.id)
.update({balance:firebase.firestore.FieldValue.increment(amt)});

saveAgentCommission(amt);

}

async function agentWithdraw(){

let uid=agentClientUID.value;
let amt=parseFloat(agentAmount.value);

const clientRef=await findUserByUID(uid);

await db.collection("users").doc(clientRef.id)
.update({balance:firebase.firestore.FieldValue.increment(-amt)});

saveAgentCommission(amt);

}

/* ===== FIND CLIENT BY UID ===== */

async function findUserByUID(uid){

const snap=await db.collection("users")
.where("gid","==",uid).get();

return snap.docs[0];

}

/* ===== COMMISSION SYSTEM ===== */

async function saveAgentCommission(amount){

let percent=0.02;
let commission=amount*percent;

await db.collection("commissions").add({
agent:auth.currentUser.uid,
amount:commission
});

}

/* ===== OFFICE COMMISSION ===== */

async function saveCommission(amount){

let percent=0.01;
let commission=amount*percent;

await db.collection("office").add({
amount:commission
});

}

/* ===== ADMIN DASHBOARD ===== */

async function loadAdmin(){

show("adminDash");

let tx=await db.collection("transactions").get();
totalTx.innerText=tx.size;

}

/* ===== LOGOUT ===== */

function logout(){
auth.signOut();
show("login");
}

</script>

</body>
</html>
