<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>GoPay Africa PRO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;700&display=swap" rel="stylesheet">

<style>
body{margin:0;font-family:Roboto;background:#061e1c;color:#e6fffa}
header{background:#012b28;padding:12px 20px;display:flex;justify-content:space-between}
.logo{font-size:22px;font-weight:700;color:#5eead4}

.panel{background:#043837;margin:15px;padding:20px;border-radius:18px}
.hidden{display:none}

button{width:100%;padding:12px;margin-top:10px;border:none;border-radius:10px;background:#14b8a6;font-weight:700;cursor:pointer}
button:hover{background:#2dd4bf}

input,select{width:100%;padding:10px;margin-top:10px;border:none;border-radius:10px}

/* CARD */
.card{background:linear-gradient(135deg,#0b3c39,#021f1d);padding:20px;border-radius:20px;height:200px;cursor:pointer}
.card-inner{position:relative;height:100%;transition:.6s;transform-style:preserve-3d}
.card.flip .card-inner{transform:rotateY(180deg)}
.card-front,.card-back{position:absolute;width:100%;height:100%;backface-visibility:hidden}
.card-back{transform:rotateY(180deg);display:flex;justify-content:center;align-items:center}

/* ACTION */
.actions{display:grid;grid-template-columns:repeat(3,1fr);gap:10px;margin-top:15px}
.action{background:#14b8a6;padding:12px;text-align:center;border-radius:12px;font-weight:700;cursor:pointer}

/* TOAST */
#toast{position:fixed;bottom:30px;right:20px;background:#14b8a6;padding:12px 18px;border-radius:12px;display:none;font-weight:700}

/* TX */
.tx{background:#065f5b;padding:8px;border-radius:10px;margin-top:5px;font-size:14px}

footer{text-align:center;margin:30px;font-size:14px;opacity:.8}
footer a{color:#5eead4;margin:5px;cursor:pointer}
</style>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode/build/qrcode.min.js"></script>
</head>

<body>

<header>
<div class="logo">GoPay Africa PRO</div>
</header>

<div id="toast"></div>

<!-- HOME -->
<div id="home" class="panel">
<h3>Banque Digitale Africaine</h3>
<div id="homeQR"></div>
<button onclick="show('login')">Connexion</button>
</div>

<!-- LOGIN -->
<div id="login" class="panel hidden">
<h3>Connexion</h3>
<input id="lEmail" placeholder="Email">
<input id="lPass" type="password" placeholder="Mot de passe">
<button onclick="login()">Connexion</button>
<button onclick="show('register')">Créer compte</button>
</div>

<!-- REGISTER -->
<div id="register" class="panel hidden">
<h3>Créer Compte</h3>
<input id="rName" placeholder="Nom complet">
<input id="rEmail" placeholder="Email">
<input id="rPass" type="password" placeholder="Mot de passe">
<select id="rRole">
<option value="client">Client</option>
<option value="agent">Agent</option>
</select>
<input type="file" id="rPhoto">
<button onclick="register()">Créer</button>
</div>

<!-- DASH -->
<div id="dash" class="hidden">

<div class="panel">
<div class="card" id="card">
<div class="card-inner">

<div class="card-front">
<h3>Carte GoPay</h3>
<p id="cardName"></p>
<p id="cardId"></p>
<p>Solde : <b id="balance"></b> USD</p>
</div>

<div class="card-back">
<div id="cardQR"></div>
</div>

</div>
</div>

<div class="actions">
<div class="action" onclick="openP('pay')">Paiement</div>
<div class="action" onclick="openP('cashin')">Cash-in</div>
<div class="action" onclick="openP('cashout')">Cash-out</div>
</div>

<button id="adminBtn" class="hidden" onclick="show('admin')">Admin Panel</button>
<button id="agentBtn" class="hidden" onclick="show('agent')">Agent Panel</button>

</div>

<!-- PAY -->
<div id="pay" class="panel hidden">
<input id="payId" placeholder="ID destinataire">
<input id="payAmount" type="number" placeholder="Montant">
<button onclick="pay()">Envoyer</button>
</div>

<!-- CASHIN -->
<div id="cashin" class="panel hidden">
<input id="cinAmount" type="number" placeholder="Montant">
<button onclick="cashin()">Valider</button>
</div>

<!-- CASHOUT -->
<div id="cashout" class="panel hidden">
<input id="coutId" placeholder="ID destinataire">
<input id="coutAmount" type="number" placeholder="Montant">
<button onclick="cashout()">Envoyer</button>
</div>

<div class="panel">
<h3>Historique</h3>
<div id="myTx"></div>

<h3>Activités publiques</h3>
<div id="marketTx"></div>
</div>

</div>

<!-- ADMIN -->
<div id="admin" class="panel hidden">
<h3>Gestion utilisateurs</h3>
<table id="usersTable"></table>
</div>

<!-- AGENT -->
<div id="agent" class="panel hidden">
<h3>Suivi Clients Agent</h3>
<div id="agentClients"></div>
</div>

<footer>
<a onclick="info('about')">Qui sommes-nous</a>
<a onclick="info('faq')">FAQ</a>
<a onclick="info('conf')">Confidentialité</a>
<a onclick="info('contact')">Contact</a>
<a onclick="info('legal')">Mentions légales</a>
</footer>

<div id="infoBox" class="panel hidden"></div>

<script>

/* FIREBASE */
firebase.initializeApp({
apiKey:"AIzaSyA-p_WgDeRhaGsP0zJYmd9aIw7GwuC6k6g",
authDomain:"gotrustpay-e6524.firebaseapp.com",
projectId:"gotrustpay-e6524",
storageBucket:"gotrustpay-e6524.appspot.com"
});
const auth=firebase.auth();
const db=firebase.firestore();
const storage=firebase.storage();

/* NAV */
function show(id){
document.querySelectorAll(".panel,#dash").forEach(d=>d.classList.add("hidden"))
document.getElementById(id).classList.remove("hidden")
}

/* TOAST */
function toast(msg){
toastBox.innerText=msg
toastBox.style.display="block"
setTimeout(()=>toastBox.style.display="none",2500)
}
const toastBox=document.getElementById("toast")

/* CARD FLIP */
card.onclick=()=>card.classList.toggle("flip")

function genId(){return "GP-"+Math.random().toString(36).substr(2,8).toUpperCase()}

/* REGISTER */
async function register(){
try{
let photo="https://i.pravatar.cc/150?img=65"
if(rPhoto.files[0]){
const ref=storage.ref().child("profiles/"+Date.now())
await ref.put(rPhoto.files[0])
photo=await ref.getDownloadURL()
}

const cred=await auth.createUserWithEmailAndPassword(rEmail.value,rPass.value)

await db.collection("users").doc(cred.user.uid).set({
name:rName.value,
email:rEmail.value,
gid:genId(),
balance:50,
role:rRole.value,
kyc:"none",
photo:photo
})

rName.value=rEmail.value=rPass.value=""
toast("Compte créé avec succès")
loginAuto()

}catch(e){toast(e.message)}
}

/* LOGIN */
async function login(){
try{
await auth.signInWithEmailAndPassword(lEmail.value,lPass.value)
lEmail.value=lPass.value=""
loginAuto()
}catch(e){toast("Connexion refusée")}
}

/* LOGIN AUTO */
async function loginAuto(){
const user=auth.currentUser
if(!user)return

const snap=await db.collection("users").doc(user.uid).get()
const d=snap.data()

cardName.innerText=d.name
cardId.innerText=d.gid
balance.innerText=d.balance.toFixed(2)

QRCode.toCanvas(cardQR,d.gid)

if(d.role==="admin") adminBtn.classList.remove("hidden")
if(d.role==="agent") agentBtn.classList.remove("hidden")

loadMyTx()
show("dash")
}

/* PAY */
async function pay(){
const amt=parseFloat(payAmount.value)
const me=await db.collection("users").doc(auth.currentUser.uid).get()
const dest=await db.collection("users").where("gid","==",payId.value).get()

if(dest.empty || me.data().balance<amt)return toast("Erreur transaction")

await db.collection("users").doc(auth.currentUser.uid).update({balance:firebase.firestore.FieldValue.increment(-amt)})
await db.collection("users").doc(dest.docs[0].id).update({balance:firebase.firestore.FieldValue.increment(amt)})

await db.collection("tx").add({from:me.data().gid,to:payId.value,type:"Paiement",amount:amt,date:new Date()})

toast("Paiement envoyé")
loadMyTx()
}

/* CASHIN */
async function cashin(){
const amt=parseFloat(cinAmount.value)
await db.collection("users").doc(auth.currentUser.uid).update({balance:firebase.firestore.FieldValue.increment(amt)})
toast("Cash-in validé")
}

/* CASHOUT */
async function cashout(){
const amt=parseFloat(coutAmount.value)
const me=await db.collection("users").doc(auth.currentUser.uid).get()
const dest=await db.collection("users").where("gid","==",coutId.value).get()

if(dest.empty || me.data().balance<amt)return toast("Erreur")

await db.collection("users").doc(auth.currentUser.uid).update({balance:firebase.firestore.FieldValue.increment(-amt)})
await db.collection("users").doc(dest.docs[0].id).update({balance:firebase.firestore.FieldValue.increment(amt)})

toast("Cash-out envoyé")
}

/* TX */
async function loadMyTx(){
myTx.innerHTML=""
const snap=await db.collection("tx").where("from","==",cardId.innerText).limit(5).get()
snap.forEach(d=>{
const t=d.data()
myTx.innerHTML+=`<div class="tx">${t.type} • ${t.amount}</div>`
})
}

/* ADMIN */
async function loadAdmin(){
usersTable.innerHTML="<tr><th>Nom</th><th>Email</th><th>Solde</th></tr>"
const users=await db.collection("users").get()
users.forEach(doc=>{
const u=doc.data()
usersTable.innerHTML+=`<tr><td>${u.name}</td><td>${u.email}</td><td>${u.balance}</td></tr>`
})
}

/* AGENT */
async function loadAgent(){
agentClients.innerHTML=""
const users=await db.collection("users").where("role","==","client").get()
users.forEach(doc=>{
agentClients.innerHTML+=`<div class="tx">${doc.data().name}</div>`
})
}

/* MARKET FLOW */
const names=["Ali","Jean","Fatou","David","Sarah"]
setInterval(()=>{
marketTx.innerHTML=`<div class="tx">${names[Math.random()*names.length|0]} • ${(Math.random()*900+20).toFixed(2)} USD</div>`+marketTx.innerHTML
},3000)

/* INFO */
function info(type){
infoBox.classList.remove("hidden")
if(type==="about") infoBox.innerHTML="GoPay Africa est une banque digitale sécurisée."
if(type==="faq") infoBox.innerHTML="Transactions rapides et protégées."
if(type==="conf") infoBox.innerHTML="Protection données internationales."
if(type==="contact") infoBox.innerHTML="@gopapay.info"
if(type==="legal") infoBox.innerHTML="GoPay Africa - Tous droits réservés"
}

/* QR HOME */
QRCode.toCanvas(homeQR,"GoPay Africa")

</script>

</body>
</html>
