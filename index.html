<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GoTrust Pay</title>
<style>
body { margin:0; font-family: Arial, sans-serif; background:#f5f5f5; color:#333; }
header { background:#0a74da; color:#fff; padding:20px; text-align:center; }
nav { display:flex; justify-content:center; gap:15px; padding:10px; background:#0073c2; flex-wrap:wrap;}
nav a { color:#fff; text-decoration:none; font-weight:bold; }
main { max-width:1000px; margin:20px auto; padding:20px; background:#fff; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
h2 { color:#0a74da; margin-top:0; }
button { background:#0a74da; color:#fff; border:none; padding:10px 20px; border-radius:5px; cursor:pointer; margin-top:5px; }
input, select, textarea { padding:10px; margin:5px 0; width:100%; box-sizing:border-box; }
.section { margin-bottom:40px; }
.hidden { display:none; }
.card { border:1px solid #ddd; padding:15px; border-radius:8px; margin-bottom:15px; background:#f9f9f9; }
.qr { width:100px; height:100px; display:inline-block; margin-right:10px; vertical-align:middle; }
label { font-weight:bold; display:block; margin-top:10px; }
.menu { display:flex; gap:10px; margin-bottom:20px; flex-wrap:wrap; }
#chatHistory { max-height:200px; overflow:auto; border:1px solid #ddd; padding:5px; margin-top:5px; background:#f0f0f0; }
</style>
</head>
<body>

<header>
  <h1>GoTrust Pay</h1>
  <p>Plateforme financière sécurisée</p>
</header>

<nav>
  <a href="#" onclick="showSection('home')">Accueil</a>
  <a href="#" onclick="showSection('login')">Connexion</a>
  <a href="#" onclick="showSection('contact')">Contact</a>
  <a href="#" onclick="showSection('about')">Qui sommes-nous ?</a>
  <a href="#" onclick="showSection('services')">Nos services</a>
  <a href="#" onclick="showSection('partners')">Nos partenaires</a>
</nav>

<main>
  <div class="section" id="home">
    <h2>Bienvenue sur GoTrust Pay</h2>
    <p>Plateforme sécurisée pour gérer vos paiements, dépôts, retraits et prêts.</p>
  </div>

  <div class="section hidden" id="login">
    <h2>Connexion</h2>
    <label>Statut</label>
    <select id="loginStatus">
      <option value="client">Client</option>
      <option value="admin">Administrateur</option>
    </select>
    <input type="text" id="loginId" placeholder="ID ou nom admin">
    <input type="password" id="loginPassword" placeholder="Mot de passe">
    <button onclick="login()">Se connecter</button>

    <div id="inlineRegister" style="margin-top:20px; border-top:1px solid #ddd; padding-top:15px;">
      <h3>Créer un compte client</h3>
      <label>Nom complet</label><input type="text" id="regName">
      <label>Email</label><input type="email" id="regEmail">
      <label>Téléphone</label><input type="text" id="regPhone">
      <label>Mot de passe</label><input type="password" id="regPassword">
      <label>Code de retrait (6 chiffres)</label><input type="text" id="regCode">
      <button onclick="register()">S'inscrire</button>
    </div>
  </div>

  <div class="section hidden" id="clientDashboard">
    <h2>Tableau de bord Client</h2>
    <div class="card">
      <h3>Carte Virtuelle</h3>
      <canvas class="qr" id="clientQR"></canvas>
      <p>ID : <span id="clientIdDisplay"></span></p>
      <p>Carte : <span id="clientCardNumber"></span></p>
      <p>Solde : <span id="clientBalance">0.00 USD</span></p>
      <button onclick="downloadCard()">Télécharger carte</button>
    </div>

    <div class="menu">
      <button onclick="showClientSection('deposit')">Déposer</button>
      <button onclick="showClientSection('withdraw')">Retirer</button>
      <button onclick="showClientSection('send')">Envoyer</button>
      <button onclick="showClientSection('loan')">Demande de prêt</button>
      <button onclick="showClientSection('chat')">Chat</button>
    </div>

    <div id="clientActions">
      <div class="hidden" id="deposit">
        <h3>Déposer</h3>
        <input type="number" id="depositAmount" placeholder="Montant">
        <button onclick="deposit()">Confirmer</button>
      </div>
      <div class="hidden" id="withdraw">
        <h3>Retirer</h3>
        <input type="number" id="withdrawAmount" placeholder="Montant">
        <input type="text" id="withdrawCode" placeholder="Code de retrait">
        <button onclick="withdraw()">Confirmer</button>
      </div>
      <div class="hidden" id="send">
        <h3>Envoyer argent</h3>
        <input type="number" id="sendAmount" placeholder="Montant">
        <input type="text" id="sendRecipient" placeholder="ID destinataire">
        <input type="password" id="sendPassword" placeholder="Mot de passe">
        <button onclick="sendMoney()">Envoyer</button>
      </div>
      <div class="hidden" id="loan">
        <h3>Demande de prêt</h3>
        <input type="number" id="loanAmount" placeholder="Montant">
        <textarea id="loanReason" placeholder="Motif"></textarea>
        <button onclick="requestLoan()">Soumettre</button>
      </div>
      <div class="hidden" id="chat">
        <h3>Chat</h3>
        <input type="text" id="chatRecipient" placeholder="ID destinataire">
        <textarea id="chatMessage" placeholder="Écrire message..."></textarea>
        <button onclick="sendChat()">Envoyer</button>
        <div id="chatHistory"></div>
      </div>
    </div>
  </div>

  <div class="section hidden" id="adminDashboard">
    <h2>Tableau de bord Admin</h2>
    <div id="adminActions">
      <div id="historyList"></div>
      <div id="clientsList"></div>
    </div>
  </div>

  <div class="section hidden" id="contact"><h2>Contact</h2><p>Email : gotrustpayinfo@gmail.com</p></div>
  <div class="section hidden" id="about"><h2>Qui sommes-nous ?</h2><p>Plateforme financière sécurisée.</p></div>
  <div class="section hidden" id="services"><h2>Nos services</h2></div>
  <div class="section hidden" id="partners"><h2>Nos partenaires</h2></div>
</main>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-app.js";
import { getFirestore, doc, setDoc, getDoc, collection, addDoc, onSnapshot, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.6.1/firebase-firestore.js";

const firebaseConfig = {
  apiKey: "AIzaSyA-p_WgDeRhaGsP0zJYmd9aIw7GwuC6k6g",
  authDomain: "gotrustpay-e6524.firebaseapp.com",
  projectId: "gotrustpay-e6524",
  storageBucket: "gotrustpay-e6524.appspot.com",
  messagingSenderId: "177034024636",
  appId: "1:177034024636:web:da80102cc82dd7cfa2a2b9"
};
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
let currentUser=null;

function showSection(id){ document.querySelectorAll('main .section').forEach(s=>s.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); }
function showClientSection(id){ document.querySelectorAll('#clientActions > div').forEach(d=>d.classList.add('hidden')); document.getElementById(id).classList.remove('hidden'); }

function generateId(){ return Math.floor(10000000 + Math.random()*90000000); }
function generateCard(){ return Math.floor(100000000000 + Math.random()*900000000000); }
function generateQRCode(text){ const canvas=document.getElementById('clientQR'); const ctx=canvas.getContext('2d'); ctx.clearRect(0,0,100,100); ctx.fillStyle='#ccc'; ctx.fillRect(0,0,100,100); ctx.fillStyle='#000'; ctx.font='10px Arial'; ctx.fillText(text,5,50);}
function downloadCard(){ const canvas=document.getElementById('clientQR'); const link=document.createElement('a'); link.download=`Carte-${currentUser.id}.png`; link.href=canvas.toDataURL(); link.click(); }

async function register(){
  const name=document.getElementById('regName').value;
  const email=document.getElementById('regEmail').value;
  const phone=document.getElementById('regPhone').value;
  const password=document.getElementById('regPassword').value;
  const code=document.getElementById('regCode').value;
  if(!name||!email||!phone||!password||!code){ alert('Remplir tous les champs'); return; }
  const id=generateId(); 
  const cardNumber=generateCard();
  const user={id,name,email,phone,password,code,balance:0,cardNumber,status:'client'};
  await setDoc(doc(db,'users',id.toString()),user);
  currentUser=user; updateClientCard(currentUser); showSection('clientDashboard'); alert('Compte créé ! ID:'+id); listenHistory(); loadChat();
}

async function login(){
  const status=document.getElementById('loginStatus').value;
  const id=document.getElementById('loginId').value.trim();
  const pwd=document.getElementById('loginPassword').value;
  if(status==='admin' && id==='gopay' && pwd==='admin243'){ currentUser={name:'Admin',id:'gopay',status:'admin'}; showSection('adminDashboard'); listenHistory(); return; }
  const docSnap=await getDoc(doc(db,'users',id));
  if(!docSnap.exists()){alert('Utilisateur introuvable'); return;}
  const user=docSnap.data();
  if(user.password!==pwd){alert('Mot de passe incorrect'); return;}
  currentUser=user; showSection('clientDashboard'); updateClientCard(user); listenHistory(); loadChat();
}

function updateClientCard(user){ document.getElementById('clientIdDisplay').textContent=user.id; document.getElementById('clientCardNumber').textContent=user.cardNumber; document.getElementById('clientBalance').textContent=user.balance.toFixed(2)+' USD'; generateQRCode(`ID:${user.id} | Carte:${user.cardNumber}`); }

async function deposit(){ const amt=parseFloat(document.getElementById('depositAmount').value); if(isNaN(amt)||amt<=0){alert('Montant invalide'); return;} currentUser.balance+=amt; updateClientCard(currentUser); await setDoc(doc(db,'users',currentUser.id.toString()),currentUser); await addDoc(collection(db,'history'),{type:'dépôt',user:currentUser.name,amount:amt,date:serverTimestamp()}); alert('Dépôt effectué'); }

async function withdraw(){ const amt=parseFloat(document.getElementById('withdrawAmount').value); const code=document.getElementById('withdrawCode').value; if(isNaN(amt)||amt<=0){alert('Montant invalide'); return;} if(code!==currentUser.code){alert('Code incorrect'); return;} if(currentUser.balance<amt){alert('Solde insuffisant'); return;} currentUser.balance-=amt; updateClientCard(currentUser); await setDoc(doc(db,'users',currentUser.id.toString()),currentUser); await addDoc(collection(db,'history'),{type:'retrait',user:currentUser.name,amount:amt,date:serverTimestamp()}); alert('Retrait effectué'); }

async function sendMoney(){ const amt=parseFloat(document.getElementById('sendAmount').value); const recipient=document.getElementById('sendRecipient').value; const pwd=document.getElementById('sendPassword').value; if(pwd!==currentUser.password){alert('Mot de passe incorrect'); return;} const docSnap=await getDoc(doc(db,'users',recipient)); if(!docSnap.exists()){alert('Destinataire introuvable'); return;} const rec=docSnap.data(); if(currentUser.balance<amt){alert('Solde insuffisant'); return;} currentUser.balance-=amt; rec.balance+=amt; await setDoc(doc(db,'users',currentUser.id.toString()),currentUser); await setDoc(doc(db,'users',rec.id.toString()),rec); await addDoc(collection(db,'history'),{type:'envoi',user:currentUser.name,to:rec.name,amount:amt,date:serverTimestamp()}); alert('Envoi effectué'); }

async function requestLoan(){ const amt=parseFloat(document.getElementById('loanAmount').value); const reason=document.getElementById('loanReason').value; await addDoc(collection(db,'loans'),{user:currentUser.name,amount:amt,reason,date:serverTimestamp()}); alert('Demande de prêt soumise'); }

function listenHistory(){ const q=query(collection(db,'history'),orderBy('date','desc')); onSnapshot(q,snap=>{ let html=''; snap.forEach(doc=>{ const d=doc.data(); html+=`<div class="card">${d.type} - ${d.user} - ${d.amount||''} ${d.to?'à '+d.to:''} - ${d.date?.toDate?.()?.toLocaleString()||''}</div>`; }); if(currentUser.status==='admin'){document.getElementById('historyList').innerHTML=html;} else{document.getElementById('chatHistory').innerHTML=html;} }); }

function loadChat(){ listenHistory(); }
</script>

</body>
</html>
